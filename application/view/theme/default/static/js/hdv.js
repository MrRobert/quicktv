$(function(){if(typeof(HDV)=="undefined"){HDV={}}if(typeof(HDV.V2)=="undefined"){HDV.V2={}}HDV.V2.Allpage={VAR:{},ParentMenuHover:function(){$(".childparentli a.childparentlia").hover(function(){$(".childparentli").removeClass("active");$(this).parent().addClass("active");$(".childlv2").hide();if($(this).parent().find(".childlv2").length>0){$(this).parent().find(".childlv2").show()}});$(".childparentli a.childparentlib").hover(function(){$(".childparentli").removeClass("active");$(".childlv2").hide()});$(".childparentli a.childparentlia").first().trigger("mouseenter")},FormatUrlRewrite:function(a){a=a.toLowerCase();a=a.replace(/à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ  |ặ|ẳ|ẵ/g,"a");a=a.replace(/è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ/g,"e");a=a.replace(/ì|í|ị|ỉ|ĩ/g,"i");a=a.replace(/ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ  |ợ|ở|ỡ/g,"o");a=a.replace(/ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ/g,"u");a=a.replace(/ỳ|ý|ỵ|ỷ|ỹ/g,"y");a=a.replace(/đ/g,"d");a=a.replace(/!|@|%|\^|\*|\(|\)|\+|\=|\<|\>|\?|\/|,|\.|\:|\;|\'| |\"|\&|\#|\[|\]|~|$|_/g,"-");a=a.replace(/^\-+|\-+$/g,"");return a},InstantSearch:function(){var c=this;var b;$("#suggestbox").hide();var a;$(".txtsearch").keyup(function(d){clearInterval(b);b=setTimeout(function(){if($(".txtsearch").val().length>1){var e=$(".txtsearch").val();if(e.length===0||!e.trim()){return false}if(d.keyCode==13){window.location.href=BASE_URL+"/tim-kiem/"+c.FormatUrlRewrite(e)+".html";return}$(".btn-search").click(function(){window.location.href=BASE_URL+"/tim-kiem/"+c.FormatUrlRewrite(e)+".html";return});if(typeof(a)=="object"){if(a.abort){a.abort()}}a=$.get(BASE_URL+"/tim-kiem-nhanh.html",{keyword:e},function(){}).success(function(g){var f="";response="";try{response=JSON.parse(g)}catch(h){}if(response===false||response==null||response.length==0){$(".suggestsearch").empty();return false}$.each(response,function(i,j){f+='<li style="border-bottom:1px solid #5d5b5b;">';$.each(j,function(l,k){f+="<a href='"+k.Link+"'><span class='backdropsearch'><img width='34' height='50' src='"+k.Backdrop+"'></span><span class='ttl-moviesearch'>"+(k.KnownAs?k.KnownAs:k.MovieName)+"<span>"+k.MovieName+"</span></span></a>"});f+="</li>"});f+="<li><a href='"+BASE_URL+"/tim-kiem/"+c.FormatUrlRewrite(e)+".html' class='searchall'>Tìm tất cả kết quả theo từ khóa</a></li>";$(".suggestsearch").empty().html(f);$("#suggestbox").show()})}else{$("#suggestbox").hide()}},600)});$(".popup-search").mouseleave(function(){$("#suggestbox").hide()});if($(".txtsearch").val().length>0||$(".txtsearch").val()!=""){$(".txtsearch").mouseover(function(){$("#suggestbox").show()})}return false},Notifications:function(){var a=this;$.get(BASE_URL+"/danh-sach-tin-nhan.html",function(){}).success(function(g){try{g=JSON.parse(g);var d="";if(g&&g.Data&&g.Data.length>0){$.each(g.Data,function(e,k){if(k.Status==1){d+="<li><a id='promotion"+k.NotificationID+"' href='"+BASE_URL+"/tin-nhan-"+k.NotificationID+"/"+a.ChangeAlias(k.Title)+".html'>"+k.Title+"</a></li>"}else{if(k.Status==2){d+="<li><a id='promotion"+k.NotificationID+"' href='"+k.BodyText+"'>"+k.Title+"</a></li>"}}})}else{d+="<li class='nobg'>Bạn chưa có thông báo nào.</li>"}$(".notificationlist").empty().html(d);var c=document.cookie;cookiearray=c.split(";");var f=0;for(var b=0;b<cookiearray.length;b++){name=cookiearray[b].split("=")[0];value=cookiearray[b].split("=")[1];if(name.indexOf("promotion")>-1){f++;$("#"+value).css("color","#ABABAB")}}var j=function(){var k=0;for(var e=0;e<g.Data.length;e++){if(g.Data[e].Status==0){k++}}return g.Unread-k};if((j()-f)>0){$(".notification").show();$(".notification").text(j()-f)}}catch(h){}});$("body").on("click",".notificationlist li a",function(){var d=$(this).attr("id");var c=new Date();var b=60*24*10000;c.setTime(c.getTime()+(b*60*100000));$.cookie(d,d,{expires:c,path:"/"})})},ChangeAlias:function(a){var b=a;b=b.toLowerCase();b=b.replace(/à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ  |ặ|ẳ|ẵ/g,"a");b=b.replace(/è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ/g,"e");b=b.replace(/ì|í|ị|ỉ|ĩ/g,"i");b=b.replace(/ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ  |ợ|ở|ỡ/g,"o");b=b.replace(/ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ/g,"u");b=b.replace(/ỳ|ý|ỵ|ỷ|ỹ/g,"y");b=b.replace(/đ/g,"d");b=b.replace(/!|@|%|\^|\*|\(|\)|\+|\=|\<|\>|\?|\/|,|\.|\:|\;|\'| |\"|\&|\#|\[|\]|~|$|_/g,"-");b=b.replace(/-+-/g,"-");b=b.replace(/^\-+|\-+$/g,"");return b},Login:function(a){var b=this;$("#login_link").fancybox({helpers:{title:null},beforeClose:function(){$("#login_box .error").html("")},afterShow:function(){if(jQuery.browser.msie){$("#textUsername").focus(function(){$(".inputtooltip").fadeIn(300).delay(1500).fadeOut(300)})}else{$("#textUsername").focus()}}});$("#login_box .mybutton").click(function(){$(".ajaxloader").show();b.ajaxLogin();return false});$("#login_box").on("keydown",function(c){if(c.which==13){if($.browser.mozilla){if($("#textPassword").val()!=""&&$("#textUsername").val()!=""){$(this).find(".mybutton").trigger("click")}}else{$(this).find(".mybutton").trigger("click");return false}}});$("#login_box .reg").click(function(){$(".reg").fancybox({helpers:{title:null},beforeClose:function(){$("#forgotpassword_box .error").html("")},afterShow:function(){b.LoadCaptchaForgotPassword();$("#textemail").focus()}})});$("#btnloginmobile").click(function(){$("#btnloginmobile").fancybox({helpers:{title:null},beforeClose:function(){$("#loginmobile_box .error").html("")},afterShow:function(){}})});$("#loginmobile_box .mybutton").click(function(){$(".ajaxloader").show();b.LoginMobile();return false})},LoginMobile:function(){var c=this;var b=$("#textMobile").val();var a=/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4,5})$/;if(b==""||b==null){$("#loginmobile_box .error").html("Vui lòng nhập số điện thoại");return false}if(!b.match(a)){$("#loginmobile_box .error").html("Số điện thoại không đúng định dạng");return false}$.post(FRONTEND_URL+"/request-otp.html",{ph:b},function(){}).success(function(f){try{f=JSON.parse(f);if(f.e=="0"){$(".ajaxloader").hide();var d="";d+='<div class="error errorotp"></div>';d+='	<div class="row align-center">';d+='		<input type="text" name="otpcode" id="textoptcode" class="textbox textboxs" />   ';d+="	</div>";d+='	<div class="cmd">';d+='		<input type="submit" class="mybutton btnacceptotp" value="Xác nhận" >';d+="	</div>";d+='	<div class="clear"></div>';HDV.V2.Core.ShowNotice({width:350,title:"Nhập mã xác nhận",content:d,afterShow:function(){$(".btnacceptotp").click(function(){$(".ajaxloader").show();var e=$("#textoptcode").val();$.post(FRONTEND_URL+"/verify-otp.html",{ph:f.phone,co:e},function(){}).success(function(i){try{i=JSON.parse(i);if(i.e=="0"){$(".ajaxloader").hide();var h="<div style='padding:0px 20px'>Chúc mừng bạn đã xác nhận số điện thoại thành công.</div>";HDV.V2.Core.ShowNotice({title:"Thông báo",content:h,timeAutoHide:3000})}else{$("#loginmobile_box .errorotp").text(i.r)}}catch(j){$("#loginmobile_box .errorotp").text("Phát sinh lỗi khi xác nhận số điện thoại")}}).error(function(){$("#loginmobile_box .errorotp").text("Phát sinh lỗi khi xác nhận số điện thoại")})})}})}else{$("#loginmobile_box .error").text(f.r)}}catch(g){$("#loginmobile_box .error").text("Phát sinh lỗi khi gửi mã xác nhận")}}).error(function(){$("#loginmobile_box .error").text("Phát sinh lỗi khi gửi mã xác nhận")})},ajaxLogin:function(){var f=this;var a=$("#textUsername").val();var e=$("#textPassword").val();if(e!=""&&e!=null&&e.length>0){e=md5(e)}var b=$("#captcha").val();var d=$("#textCaptcha").val();var c=0;if($("#idR").is(":checked")){c=1}$.post(FRONTEND_URL+"/dang-nhap.html",{email:a,password:e,textcaptcha:d,remember:c,captcha:b},function(){}).success(function(g){$(".ajaxloader").hide();try{g=JSON.parse(g)}catch(h){}if(g.e=="0"){setTimeout("location.reload()",200);$("#loginform").submit()}else{$("#login_box .error").html(g.r);if(g.e=="3"){f.LoadCaptchaAjaxLogin();$(".captcha").show();$("#refeshcaptcha_login").click(function(){f.LoadCaptchaAjaxLogin()})}}})},Logout:function(){$(".logout").click(function(){$(".ajaxloader").show();$.post(FRONTEND_URL+"/dang-xuat.html",{},function(){}).success(function(a){try{a=JSON.parse(a)}catch(b){}if(a.e=="0"){$(".ajaxloader").hide();setTimeout("location.reload()",800)}else{$(".ajaxloader").hide();$("#login_box .error").html(a.r)}})})},LoginGoogle:function(){$("#authorize-button").click(function(){$(".ajaxloader").show();var a={client_id:googleClientId,scope:googleScope,immediate:false};gapi.auth.authorize(a,function(b){$.post(BASE_URL+"/dang-nhap-bang-google.html",{access_token:b.access_token},function(){}).success(function(c){$(".ajaxloader").hide();try{c=JSON.parse(c)}catch(d){}if(c.e=="0"){setTimeout("location.reload()",200)}else{$("#login_box .error").html(c.r)}})})})},LoginFacebook:function(){$("#logFacebook").click(function(){$(".ajaxloader").show();FB.login(function(a){if(a.status==="connected"){FB.api("/me",function(b){fb_access_token=FB.getAuthResponse()["accessToken"];if(fb_access_token!=undefined){$.post(FRONTEND_URL+"/dang-nhap-bang-facebook.html",{accesstoken:fb_access_token,email:b.email},function(){}).success(function(c){try{c=JSON.parse(c)}catch(d){}$(".ajaxloader").hide();if(c.e==0){setTimeout("location.reload()",200)}else{$("#login_box .error").html(c.r)}})}else{$("#login_box .error").html("Không kết nối được đến tài khoản Facebook")}})}else{$("#login_box .error").html("Không kết nối được đến tài khoản Facebook")}},{scope:"email"});$(".ajaxloader").hide();return false})},ForgotPassword:function(){var a=this;$("#refeshcaptcha_forgotpass").click(function(){a.LoadCaptchaForgotPassword()});$("#click-forgotpassword").click(function(){$(".error_captcha").text("");var c=$("#textemail_forgot").val();var b=$("#captcha_forgot").val();if(c.length==0){$(".error_captcha").text("Chưa nhập địa chỉ email.");return}if(b.length==0){$(".error_captcha").text("Chưa nhập mã bảo mật");return}$(".ajaxloader").show();$.post(BASE_URL+"/quen-mat-khau.html",{email:c,captcha:b},function(){}).success(function(d){try{d=JSON.parse(d)}catch(f){}$(".ajaxloader").hide();if(d.e=="0"){HDV.V2.Core.ShowNotice({title:"Thông báo",content:d.r});return}else{$(".error_captcha").text(d.r);a.LoadCaptchaForgotPassword();$("#captcha_forgot").val("")}})})},LoadCaptchaForgotPassword:function(){$.post(BASE_URL+"/captcha/get-link.html?field=forget",function(){}).success(function(a){$("#imageCaptcha_forgot").attr({src:a})})},LoadCaptchaAjaxLogin:function(){$.post(BASE_URL+"/captcha/get-link.html?field=login",function(){}).success(function(a){$("#ajaxLoginCaptcha").attr({src:a})})},FixSelectStyleFirefox:function(){if(navigator.userAgent.indexOf("Firefox")>0){if($(".selectstyle").length>0){$(".selectstyle").each(function(a,b){$(this).css({overflow:"hidden"});$(this).find("select").width($(this).find("select").width()+60)})}}},FixSelectStyleIE:function(){if(navigator.userAgent.indexOf("MSIE")>0){if($(".selectstyle").length>0){$(".selectstyle").each(function(a,b){$(this).css({overflow:"hidden"});$(this).find("select").width($(this).find("select").width()+90)})}}},ClickUploadPhim:function(){$("#upload_phim").click(function(){if(!isLogined){$("#login_link").trigger("click");return false}})},FixStyleMenu:function(){$("#menu-phimle .childcols2 a").each(function(){if(($(this).index()+1)%3==0){$(this).addClass("lastitemmenu")}});$("#menu-phimbo .childcols2 a").each(function(){if(($(this).index()+1)%2==0){$(this).addClass("lastitemmenu")}});$(window).scroll(function(){var a=$(window).scrollLeft();$("#Header").css("margin-left",-a)})},PopupSupport:function(){$("body").on("click",".support_ads",function(){var a="";a+=' <div class="warp">';a+=' <h2 class="h2-ttlpopup" style="padding-left:15px;padding-right: 15px">Liên hệ quảng cáo</h2>';a+=' <div class="contentpopup">';a+=' <span style="font-weight:bold">Liên Hệ: </span> <a href="mailto:long@blueseed.vn" >long@blueseed.vn</a><br><br><span style="font-weight:bold">Điện thoại:</span> 0909898455';a+=" </div> ";a+=" </div>";$.fancybox(a)})},Init:function(){this.ParentMenuHover();this.InstantSearch();this.Notifications();this.Login();this.Logout();this.PopupSupport();this.LoginGoogle();this.LoginFacebook();this.ForgotPassword();this.FixSelectStyleFirefox();this.FixSelectStyleIE();this.ClickUploadPhim();this.FixStyleMenu();this.PopupSupport()}}});$(document).ready(function(){HDV.V2.Allpage.Init()});